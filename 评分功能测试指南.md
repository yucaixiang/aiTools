# 评分功能测试指南

## ✅ 当前状态

1. ✅ 数据库迁移已完成
2. ✅ 后端服务正在运行 (端口8090, PID: 12515)
3. ✅ 前端服务正在运行 (端口3001)
4. ✅ Rating API已加载并可访问

## 🧪 测试步骤

### 方式1: 前端界面测试（推荐）

#### 步骤1: 访问前端应用
```
打开浏览器访问: http://localhost:3001
```

#### 步骤2: 登录账号
如果未登录，先登录一个测试账号

#### 步骤3: 测试评分功能

1. **进入工具详情页**
   - 从首页点击任意工具，进入详情页
   - 或直接访问: http://localhost:3001/tool/1

2. **查看评分显示**
   - ✅ 看到星星评分组件
   - ✅ 显示平均评分和评分人数
   - ✅ 显示"收藏人数"（不再是"推荐人数"）

3. **提交评分**
   - ✅ 点击星星进行评分（1-5分）
   - ✅ 看到"评分成功"或"评分已更新"提示
   - ✅ 评分立即更新显示

4. **修改评分**
   - ✅ 再次点击不同的星星
   - ✅ 看到"评分已更新"提示
   - ✅ 显示你的新评分

5. **删除评分**
   - ✅ 看到"你的评分: X分"和"删除评分"按钮
   - ✅ 点击"删除评分"
   - ✅ 确认后评分被删除

6. **查看评论区**
   - ✅ "写评论"按钮（不再有评分输入）
   - ✅ 评论列表中不再显示评分星星
   - ✅ 用户可以发表多条评论

### 方式2: API接口测试

#### 前提条件
需要先获取登录token:

```bash
# 1. 登录获取token
curl -X POST http://localhost:8090/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "your_username",
    "password": "your_password"
  }'

# 复制返回的token
TOKEN="返回的token值"
```

#### API测试命令

```bash
# 1. 获取工具1的评分统计（不需要登录）
curl http://localhost:8090/api/ratings/tool/1

# 2. 提交评分（需要登录）
curl -X POST http://localhost:8090/api/ratings \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "toolId": 1,
    "score": 5
  }'

# 3. 修改评分
curl -X POST http://localhost:8090/api/ratings \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "toolId": 1,
    "score": 4
  }'

# 4. 检查是否已评分
curl http://localhost:8090/api/ratings/tool/1/check \
  -H "Authorization: Bearer $TOKEN"

# 5. 删除评分
curl -X DELETE http://localhost:8090/api/ratings/tool/1 \
  -H "Authorization: Bearer $TOKEN"
```

## 🔍 功能检查清单

### 评分功能
- [ ] 星星评分组件正常显示
- [ ] 显示平均评分和评分人数
- [ ] 可以点击星星评分
- [ ] 评分成功后有toast提示
- [ ] 评分后立即更新显示
- [ ] 可以修改已有评分
- [ ] 可以删除评分
- [ ] 显示当前用户的评分状态

### 界面变更
- [ ] "推荐人数" 已改为 "收藏人数"
- [ ] 评论表单中不再有评分输入框
- [ ] 评论列表中不再显示评分星星
- [ ] 工具详情页布局正常

### 评论功能（保持原样）
- [ ] 可以发表评论（不含评分）
- [ ] 可以查看评论列表
- [ ] 可以删除自己的评论

## 📊 预期结果

### 成功的响应示例

#### 获取评分统计
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "averageRating": 4.5,
    "ratingCount": 10,
    "userScore": 5
  },
  "success": true
}
```

#### 提交评分成功
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null,
  "success": true
}
```

### 前端效果

1. **工具详情页顶部显示**:
   ```
   ❤️ 12 收藏人数
   💬 5 条评论

   ★★★★★ 4.5 (10人评分)
   你的评分: 5分 [删除评分]
   ```

2. **评论区显示**:
   ```
   用户评论 (5)  [写评论]

   [评论内容 - 不含评分显示]
   ```

## ⚠️ 常见问题

### Q1: API返回401未授权
**原因**: 需要登录才能评分
**解决**: 在前端先登录，或使用Bearer Token

### Q2: 评分提交后没有变化
**原因**: 可能是缓存问题
**解决**: 刷新页面，或清除浏览器缓存

### Q3: 前端显示NaN或undefined
**原因**: 后端返回的数据格式问题
**解决**: 检查浏览器Console的Network面板，查看API响应

### Q4: 无法点击星星
**原因**: 可能未登录或组件未加载
**解决**: 确保已登录，检查Console是否有错误

## 🐛 调试技巧

### 浏览器调试
```javascript
// 打开浏览器Console，运行：
console.log('当前用户:', localStorage.getItem('user'))
console.log('Token:', localStorage.getItem('token'))
```

### 后端日志
```bash
# 查看后端日志（如果是IDEA启动的，查看IDEA控制台）
# 或者查看进程日志
tail -f /path/to/log/file
```

### 网络请求
1. 打开浏览器开发者工具 (F12)
2. 切换到 Network 标签
3. 过滤: `ratings`
4. 查看请求和响应详情

## 📝 测试报告模板

测试完成后，请记录：

### 功能测试结果
- [ ] 评分提交: ✅ / ❌
- [ ] 评分修改: ✅ / ❌
- [ ] 评分删除: ✅ / ❌
- [ ] 评分显示: ✅ / ❌
- [ ] 界面变更: ✅ / ❌

### 发现的问题
1. 问题描述
2. 重现步骤
3. 预期结果 vs 实际结果
4. 截图（如有）

### 测试环境
- 浏览器: Chrome / Firefox / Safari
- 前端地址: http://localhost:3001
- 后端地址: http://localhost:8090
- 测试工具ID:
- 测试用户:

---

## 🎉 下一步

测试通过后：
1. 可以开始实现评论回复功能
2. 或者部署到测试/生产环境
3. 或者优化性能和用户体验

**祝测试顺利！** 🚀
