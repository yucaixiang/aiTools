# AI工具推荐系统 - 完整启动指南

本指南将帮助您从零开始启动整个系统，包括基础设施、后端服务和前端应用。

## 系统架构概览

```
┌─────────────────────────────────────────────────────────────┐
│                        用户访问层                            │
├─────────────────────────────────────────────────────────────┤
│  用户前端(3000)          │         管理后台(3001)            │
├─────────────────────────────────────────────────────────────┤
│                     API网关 (8080)                           │
├─────────────────────────────────────────────────────────────┤
│  用户服务  │  工具服务  │  推荐服务  │  搜索服务  │ AI服务   │
│   (8081)  │   (8082)  │   (8083)  │   (8084)  │  (8085)  │
├─────────────────────────────────────────────────────────────┤
│            基础设施层 (Docker容器)                            │
│  MySQL(3306) │ Redis(6379) │ ES(9200) │ Ollama(11434)     │
└─────────────────────────────────────────────────────────────┘
```

## 前置要求

- **Docker Desktop**: 已安装并运行
- **Java**: JDK 17 或更高版本
- **Maven**: 3.6 或更高版本
- **Node.js**: 16.x 或更高版本
- **npm**: 8.x 或更高版本
- **IntelliJ IDEA**: 推荐使用(可选，用于后端开发)

## 第一步: 启动基础设施 (Docker容器)

### 1.1 确认Docker Desktop正在运行

```bash
docker --version
docker-compose --version
```

### 1.2 启动所有基础服务

```bash
cd /Users/bjsttlp324/Desktop/tools
docker-compose up -d
```

### 1.3 验证服务状态

```bash
docker-compose ps
```

应该看到以下服务都处于 `Up` 状态:
- `mysql` - MySQL数据库 (端口3306)
- `redis` - Redis缓存 (端口6379)
- `elasticsearch` - 搜索引擎 (端口9200)
- `ollama` - AI模型服务 (端口11434)

### 1.4 查看服务日志(可选)

```bash
# 查看所有服务日志
docker-compose logs

# 查看特定服务日志
docker-compose logs mysql
docker-compose logs elasticsearch
```

## 第二步: 初始化数据库

### 2.1 连接到MySQL

```bash
docker exec -it tools-mysql-1 mysql -uroot -proot123456
```

### 2.2 创建数据库

```sql
CREATE DATABASE IF NOT EXISTS tool_recommend CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE tool_recommend;
```

### 2.3 导入数据库表结构和初始数据

在MySQL客户端中执行:

```sql
source /docker-entrypoint-initdb.d/init-db.sql;
```

或者从宿主机执行:

```bash
docker exec -i tools-mysql-1 mysql -uroot -proot123456 tool_recommend < /Users/bjsttlp324/Desktop/tools/database/init-db.sql
```

### 2.4 验证数据库

```sql
-- 查看所有表
SHOW TABLES;

-- 查看分类数据
SELECT * FROM category;

-- 查看标签数据
SELECT * FROM tag;

-- 退出MySQL
EXIT;
```

## 第三步: 启动后端服务

### 方式A: 使用IntelliJ IDEA (推荐)

#### 3.1 打开项目

1. 启动IntelliJ IDEA
2. 选择 `File` -> `Open`
3. 选择 `/Users/bjsttlp324/Desktop/tools/backend` 目录
4. 等待Maven依赖下载完成

#### 3.2 配置JDK

1. `File` -> `Project Structure` -> `Project`
2. 设置 `SDK` 为 JDK 17 或更高版本
3. 点击 `Apply` 和 `OK`

#### 3.3 启动服务(按顺序)

**注意**: 必须按照以下顺序启动服务!

1. **第一个启动: Gateway (网关服务)**
   - 展开 `gateway` 模块
   - 找到 `src/main/java/com/tools/gateway/GatewayApplication.java`
   - 右键 -> `Run 'GatewayApplication'`
   - 等待启动完成(看到 "Started GatewayApplication")

2. **第二个启动: User Service (用户服务)**
   - 展开 `user-service` 模块
   - 找到 `src/main/java/com/tools/user/UserServiceApplication.java`
   - 右键 -> `Run 'UserServiceApplication'`
   - 等待启动完成

3. **第三个启动: Tool Service (工具服务)**
   - 展开 `tool-service` 模块
   - 找到 `src/main/java/com/tools/tool/ToolServiceApplication.java`
   - 右键 -> `Run 'ToolServiceApplication'`
   - 等待启动完成

4. **第四个启动: Recommend Service (推荐服务)**
   - 展开 `recommend-service` 模块
   - 找到 `src/main/java/com/tools/recommend/RecommendServiceApplication.java`
   - 右键 -> `Run 'RecommendServiceApplication'`
   - 等待启动完成

5. **第五个启动: Search Service (搜索服务)**
   - 展开 `search-service` 模块
   - 找到 `src/main/java/com/tools/search/SearchServiceApplication.java`
   - 右键 -> `Run 'SearchServiceApplication'`
   - 等待启动完成

6. **第六个启动: AI Service (AI服务)**
   - 展开 `ai-service` 模块
   - 找到 `src/main/java/com/tools/ai/AiServiceApplication.java`
   - 右键 -> `Run 'AiServiceApplication'`
   - 等待启动完成

#### 3.4 验证所有服务已启动

在IDEA的 `Run` 工具窗口中，应该能看到6个正在运行的应用:
- GatewayApplication (8080)
- UserServiceApplication (8081)
- ToolServiceApplication (8082)
- RecommendServiceApplication (8083)
- SearchServiceApplication (8084)
- AiServiceApplication (8085)

### 方式B: 使用命令行

如果Maven依赖问题已解决，可以使用命令行启动:

```bash
cd /Users/bjsttlp324/Desktop/tools/backend

# 编译项目
mvn clean package -DskipTests

# 启动网关
java -jar gateway/target/gateway-1.0-SNAPSHOT.jar &

# 等待5秒后启动用户服务
sleep 5
java -jar user-service/target/user-service-1.0-SNAPSHOT.jar &

# 等待5秒后启动工具服务
sleep 5
java -jar tool-service/target/tool-service-1.0-SNAPSHOT.jar &

# 等待5秒后启动推荐服务
sleep 5
java -jar recommend-service/target/recommend-service-1.0-SNAPSHOT.jar &

# 等待5秒后启动搜索服务
sleep 5
java -jar search-service/target/search-service-1.0-SNAPSHOT.jar &

# 等待5秒后启动AI服务
sleep 5
java -jar ai-service/target/ai-service-1.0-SNAPSHOT.jar &
```

### 3.5 验证后端服务

```bash
# 检查网关健康状态
curl http://localhost:8080/actuator/health

# 检查用户服务
curl http://localhost:8081/actuator/health

# 检查工具服务
curl http://localhost:8082/actuator/health
```

## 第四步: 启动前端应用

### 4.1 启动用户前端 (端口3000)

#### 检查依赖是否已安装

```bash
cd /Users/bjsttlp324/Desktop/tools/frontend/uniapp
ls node_modules/
```

如果 `node_modules` 目录不存在或为空:

```bash
npm install
```

#### 启动开发服务器

```bash
npm run dev
```

访问: `http://localhost:3000`

### 4.2 启动管理后台 (端口3001)

打开新的终端窗口:

```bash
cd /Users/bjsttlp324/Desktop/tools/frontend/admin
npm run dev
```

访问: `http://localhost:3001`

**默认管理员账号:**
- 用户名: `admin`
- 密码: `admin123`

## 第五步: 验证系统功能

### 5.1 验证管理后台

1. 打开浏览器访问 `http://localhost:3001`
2. 使用 `admin` / `admin123` 登录
3. 查看仪表盘数据
4. 尝试访问各个功能模块

### 5.2 验证用户前端

1. 打开浏览器访问 `http://localhost:3000`
2. 浏览工具列表
3. 测试搜索功能
4. 测试分类筛选

### 5.3 验证API接口

```bash
# 测试用户登录
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{"account":"admin","password":"admin123"}'

# 测试获取工具列表
curl http://localhost:8080/api/tools

# 测试获取分类列表
curl http://localhost:8080/api/categories
```

## 故障排除

### 问题1: Docker容器无法启动

```bash
# 查看容器日志
docker-compose logs [service-name]

# 重启容器
docker-compose restart [service-name]

# 完全重建容器
docker-compose down
docker-compose up -d
```

### 问题2: MySQL连接失败

```bash
# 检查MySQL是否正在运行
docker ps | grep mysql

# 查看MySQL日志
docker-compose logs mysql

# 重启MySQL
docker-compose restart mysql
```

### 问题3: 后端服务启动失败

- **检查端口占用**: 确保8080-8085端口没有被其他程序占用
- **检查日志**: 查看IDEA控制台或命令行输出的错误信息
- **检查依赖**: 确保Maven依赖下载完整
- **检查数据库**: 确保MySQL已启动并且数据库已初始化

### 问题4: 前端无法连接后端

- **检查后端服务**: 确保网关服务(8080)正在运行
- **检查CORS**: 检查浏览器控制台是否有跨域错误
- **检查代理配置**: 检查 `vite.config.js` 中的代理设置

### 问题5: Maven编译失败

目前已知 `common` 模块存在依赖问题，推荐使用IntelliJ IDEA而非Maven命令行编译。

IDEA会自动处理Lombok注解处理和依赖解析。

## 开发环境端口总览

| 服务 | 端口 | 访问地址 |
|------|------|---------|
| 用户前端 | 3000 | http://localhost:3000 |
| 管理后台 | 3001 | http://localhost:3001 |
| API网关 | 8080 | http://localhost:8080 |
| 用户服务 | 8081 | http://localhost:8081 |
| 工具服务 | 8082 | http://localhost:8082 |
| 推荐服务 | 8083 | http://localhost:8083 |
| 搜索服务 | 8084 | http://localhost:8084 |
| AI服务 | 8085 | http://localhost:8085 |
| MySQL | 3306 | localhost:3306 |
| Redis | 6379 | localhost:6379 |
| Elasticsearch | 9200 | http://localhost:9200 |
| Ollama | 11434 | http://localhost:11434 |

## 停止服务

### 停止前端服务

在运行 `npm run dev` 的终端中按 `Ctrl+C`

### 停止后端服务

在IntelliJ IDEA中点击每个服务窗口的停止按钮

或者在命令行中:

```bash
# 查找Java进程
ps aux | grep java

# 终止进程
kill -9 [PID]
```

### 停止Docker服务

```bash
cd /Users/bjsttlp324/Desktop/tools
docker-compose down
```

## 下一步

- 查看 `/Users/bjsttlp324/Desktop/tools/frontend/admin/README.md` 了解管理后台详细信息
- 查看 `/Users/bjsttlp324/Desktop/tools/后端服务启动指南.md` 了解后端服务详细配置
- 查看 `/Users/bjsttlp324/Desktop/tools/系统当前状态.md` 了解项目整体进度

## 技术支持

如遇到问题，请检查:
1. 所有Docker容器是否正常运行
2. 数据库是否正确初始化
3. 后端服务启动顺序是否正确
4. 端口是否被占用
5. 浏览器控制台和服务日志中的错误信息
