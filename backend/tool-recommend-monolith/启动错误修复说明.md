# MyBatis Plus 启动错误修复说明

## 问题描述

启动应用时出现以下错误：

```
java.lang.IllegalArgumentException: Invalid value type for attribute 'factoryBeanObjectType': java.lang.String
	at org.springframework.beans.factory.support.FactoryBeanRegistrySupport.getTypeForFactoryBeanFromAttributes
```

## 问题原因

1. **@MapperScan通配符路径问题**：使用了 `@MapperScan("com.toolrecommend.*.mapper")` 通配符路径
2. **MyBatis Plus版本兼容性**：MyBatis Plus 3.5.7 与 Spring Boot 3.2.0 在处理通配符路径时可能存在兼容性问题
3. **Bean工厂类型推断错误**：Spring无法正确推断FactoryBean的类型

## 解决方案

### 方案一：使用明确的包路径（已应用）✅

将通配符路径改为明确的包路径列表：

```java
@MapperScan(basePackages = {
    "com.toolrecommend.tool.mapper", 
    "com.toolrecommend.user.mapper", 
    "com.toolrecommend.review.mapper"
})
```

**优点**：
- 明确指定扫描路径，避免通配符解析问题
- 性能更好，扫描范围更精确

**缺点**：
- 如果新增Mapper包，需要手动添加路径

### 方案二：移除@MapperScan（备选）

如果方案一仍然有问题，可以完全移除 `@MapperScan`，因为每个Mapper接口都已经使用了 `@Mapper` 注解：

```java
@SpringBootApplication
// 移除 @MapperScan，因为每个Mapper接口都有@Mapper注解
public class ToolRecommendApplication {
    // ...
}
```

**优点**：
- 最简单，不需要维护扫描路径
- 每个Mapper独立管理

**缺点**：
- 必须确保每个Mapper接口都有 `@Mapper` 注解

### 方案三：更新MyBatis Plus版本（备选）

如果上述方案都不行，可以尝试更新MyBatis Plus到最新版本：

```xml
<properties>
    <mybatis-plus.version>3.5.8</mybatis-plus.version>
</properties>
```

## 已完成的修复

✅ **ToolRecommendApplication.java** - 已将通配符路径改为明确的包路径列表

## 验证修复

重新启动应用：

```bash
cd /Users/bjsttlp324/Desktop/tools/backend/tool-recommend-monolith
mvn spring-boot:run
```

应该看到：
```
========================================
   Tool Recommend 单体应用启动成功!
   访问地址: http://localhost:8080
========================================
```

## 如果仍然报错

### 尝试方案二：移除@MapperScan

如果方案一仍然有问题，修改 `ToolRecommendApplication.java`：

```java
@SpringBootApplication
// 移除 @MapperScan 注解
public class ToolRecommendApplication {
    public static void main(String[] args) {
        SpringApplication.run(ToolRecommendApplication.class, args);
        // ...
    }
}
```

**注意**：确保所有Mapper接口都有 `@Mapper` 注解，例如：

```java
@Mapper
public interface ToolMapper extends BaseMapper<Tool> {
    // ...
}
```

### 检查Mapper接口

确认所有Mapper接口都正确标注了 `@Mapper`：

```bash
# 查找所有Mapper接口
find src/main/java -name "*Mapper.java" -exec grep -L "@Mapper" {} \;
```

如果发现有Mapper接口缺少 `@Mapper` 注解，需要添加。

## 技术说明

### @MapperScan vs @Mapper

- **@MapperScan**：在启动类上使用，批量扫描指定包下的Mapper接口
- **@Mapper**：在Mapper接口上使用，标记单个接口为Mapper

### 通配符路径问题

`com.toolrecommend.*.mapper` 这种通配符路径在某些情况下：
- Spring Boot 3.x 和 MyBatis Plus 3.5.x 的组合可能无法正确解析
- 可能导致Bean工厂类型推断失败

### 推荐做法

1. **开发阶段**：使用明确的包路径列表，便于调试
2. **生产环境**：确保每个Mapper都有 `@Mapper` 注解，可以移除 `@MapperScan`

## 相关文件

- `backend/tool-recommend-monolith/src/main/java/com/toolrecommend/ToolRecommendApplication.java` - 启动类
- `backend/tool-recommend-monolith/pom.xml` - Maven依赖配置

---

**修复日期**: 2025-12-10
**状态**: ✅ 已修复（方案一）

