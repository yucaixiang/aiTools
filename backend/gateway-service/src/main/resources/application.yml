server:
  port: 8090

spring:
  application:
    name: gateway-service
  # 设置Web应用类型为reactive（WebFlux），Gateway必须使用reactive模式
  main:
    web-application-type: reactive

  cloud:
    gateway:
      # 路由配置 - 简化为单体应用路由
      routes:
        # 单体应用路由 - 所有API请求都转发到monolith
        - id: monolith-service
          uri: http://localhost:8080
          predicates:
            - Path=/api/**
          filters:
            - StripPrefix=0
            - name: RequestRateLimiter
              args:
                redis-rate-limiter.replenishRate: 10  # 每秒生成令牌数
                redis-rate-limiter.burstCapacity: 20  # 令牌桶容量
                key-resolver: "#{@ipKeyResolver}"

      # 全局CORS配置
      globalcors:
        cors-configurations:
          '[/**]':
            allowed-origins:
              - "http://localhost:3000"
              - "http://localhost:3001"
              - "http://localhost:8090"
              - "http://localhost:8081"
              - "http://localhost:8082"
            allowed-methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
            allowed-headers: "*"
            allow-credentials: true
            max-age: 3600

      # 默认过滤器
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Origin Access-Control-Allow-Credentials

  redis:
    host: localhost
    port: 6379
    password: redis123456
    database: 1
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5

# JWT配置
jwt:
  secret: tool-recommend-secret-key-2024-should-be-very-long-and-secure

# 鉴权白名单（不需要Token的接口，逗号分隔）
# 注意: /api/tools/** 和 /api/categories/** 不需要登录即可访问（游客可查看工具列表和详情）
# 注意: /api/reviews/tool/** 不需要登录即可访问（游客可查看评论）
# 注意: 收藏、点赞、写评论等操作需要登录
auth:
  whitelist: /api/users/register,/api/users/login,/api/users/refresh-token,/api/users/check-username,/api/users/check-email,/api/tools,/api/tools/*/detail,/api/tools/search,/api/tools/category/*,/api/categories,/api/categories/*,/api/reviews/tool/*,/actuator/**

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,gateway
  endpoint:
    health:
      show-details: always

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    com.toolrecommend: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
