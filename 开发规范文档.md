# AI工具推荐系统 - 开发规范文档

## 文档信息
- **项目名称**：智能工具推荐平台
- **版本**：v1.0
- **创建日期**：2025-12-04

---

## 一、代码规范

### 1.1 Java代码规范

**基础规范**：遵循《阿里巴巴Java开发手册》

**命名规范**：
```java
// 类名：大驼峰（PascalCase）
public class ToolService {}
public class AIRecommendationService {}

// 方法名：小驼峰（camelCase）
public void getTool() {}
public List<Tool> searchTools(String keyword) {}

// 常量：全大写+下划线
public static final String API_BASE_URL = "https://api.example.com";
public static final int MAX_RETRY_COUNT = 3;

// 变量名：小驼峰，见名知意
private String userName;
private List<Tool> toolList;
private boolean isDeleted;

// 包名：全小写，层级清晰
com.toolrecommend.service
com.toolrecommend.controller
com.toolrecommend.repository
```

**注释规范**：
```java
/**
 * 工具服务类
 *
 * @author zhangsan
 * @since 2025-01-01
 */
@Service
@Slf4j
public class ToolService {

    /**
     * 根据ID获取工具详情
     *
     * @param id 工具ID
     * @return 工具详情，如果不存在返回null
     * @throws ToolNotFoundException 工具不存在时抛出
     */
    public Tool getToolById(Long id) {
        // 参数校验
        if (id == null || id <= 0) {
            throw new IllegalArgumentException("工具ID无效");
        }

        // 缓存查询
        Tool tool = cacheService.getTool(id);
        if (tool != null) {
            return tool;
        }

        // 数据库查询
        tool = toolMapper.selectById(id);
        if (tool == null) {
            log.warn("工具不存在, id={}", id);
            throw new ToolNotFoundException("工具不存在");
        }

        // 更新缓存
        cacheService.cacheTool(tool);

        return tool;
    }
}
```

**异常处理规范**：
```java
// 1. 自定义业务异常
public class BusinessException extends RuntimeException {
    private final int code;

    public BusinessException(int code, String message) {
        super(message);
        this.code = code;
    }
}

// 2. 具体业务异常
public class ToolNotFoundException extends BusinessException {
    public ToolNotFoundException(String message) {
        super(404, message);
    }
}

// 3. 全局异常处理
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        log.error("业务异常", e);
        return Result.error(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(Exception.class)
    public Result<?> handleException(Exception e) {
        log.error("系统异常", e);
        return Result.error(500, "系统异常，请稍后重试");
    }
}

// 4. 使用异常
public Tool getToolById(Long id) {
    Tool tool = toolMapper.selectById(id);
    if (tool == null) {
        throw new ToolNotFoundException("工具不存在: " + id);
    }
    return tool;
}
```

**日志规范**：
```java
@Slf4j
@Service
public class ToolService {

    public void updateTool(Tool tool) {
        // DEBUG：调试信息
        log.debug("开始更新工具, tool={}", tool);

        // INFO：重要业务节点
        log.info("更新工具, toolId={}, name={}", tool.getId(), tool.getName());

        try {
            toolMapper.updateById(tool);

            // 成功日志
            log.info("工具更新成功, toolId={}", tool.getId());

        } catch (Exception e) {
            // ERROR：异常日志，必须包含异常对象
            log.error("工具更新失败, toolId={}", tool.getId(), e);
            throw new BusinessException("工具更新失败");
        }
    }

    // 避免：不要使用字符串拼接
    // log.info("更新工具: " + tool.getName());  ❌

    // 推荐：使用占位符
    // log.info("更新工具: {}", tool.getName());  ✅
}
```

### 1.2 前端代码规范

**Vue3 + TypeScript规范**：
```typescript
// 组件命名：PascalCase
<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import type { Tool } from '@/types/tool'

// Props类型定义
interface Props {
  toolId: number
  showDetails?: boolean
}

// Props默认值
const props = withDefaults(defineProps<Props>(), {
  showDetails: false
})

// Emits类型定义
const emit = defineEmits<{
  click: [tool: Tool]
  favorite: [toolId: number]
}>()

// 响应式数据：小驼峰
const tool = ref<Tool | null>(null)
const isLoading = ref(false)
const errorMessage = ref('')

// 计算属性
const priceText = computed(() => {
  if (!tool.value) return ''
  return tool.value.pricingModel === 'FREE' ? '免费' : `$${tool.value.startingPrice}/月`
})

// 方法：小驼峰，动词开头
const fetchTool = async () => {
  isLoading.value = true
  try {
    const res = await api.getTool(props.toolId)
    tool.value = res.data
  } catch (error) {
    errorMessage.value = '加载失败'
    console.error('获取工具失败', error)
  } finally {
    isLoading.value = false
  }
}

const handleFavorite = () => {
  emit('favorite', props.toolId)
}

// 生命周期
onMounted(() => {
  fetchTool()
})
</script>

<template>
  <view class="tool-card">
    <view v-if="isLoading">加载中...</view>
    <view v-else-if="errorMessage">{{ errorMessage }}</view>
    <view v-else-if="tool">
      <text class="name">{{ tool.name }}</text>
      <text class="price">{{ priceText }}</text>
      <button @click="handleFavorite">收藏</button>
    </view>
  </view>
</template>

<style lang="scss" scoped>
.tool-card {
  // 使用变量
  padding: $spacing-4;
  background: $bg-white;
  border-radius: $radius-lg;

  .name {
    font-size: $font-size-lg;
    font-weight: $font-weight-semibold;
    color: $text-primary;
  }

  .price {
    color: $success;
  }
}
</style>
```

**类型定义规范**：
```typescript
// types/tool.ts

// 接口命名：PascalCase
export interface Tool {
  id: number
  name: string
  slug: string
  tagline: string
  logo: string
  category: Category
  tags: string[]
  pricingModel: PricingModel
  startingPrice: number
  averageRating: number
  reviewCount: number
  createdAt: string
}

// 枚举：PascalCase
export enum PricingModel {
  FREE = 'FREE',
  FREEMIUM = 'FREEMIUM',
  PAID = 'PAID',
  OPEN_SOURCE = 'OPEN_SOURCE'
}

// 类型别名：PascalCase
export type ToolList = Tool[]
export type ToolId = number

// DTO类型
export interface ToolQueryDTO {
  page: number
  size: number
  categoryId?: number
  tags?: string[]
  sort?: 'hot' | 'new' | 'rating'
}
```

---

## 二、Git规范

### 2.1 分支管理

```
分支策略（Git Flow）：

main（主分支）
  └── 生产环境代码，只能从release或hotfix合并

develop（开发分支）
  └── 最新开发代码，所有feature合并到此

feature/* （功能分支）
  └── 新功能开发
  └── 命名：feature/工具搜索、feature/AI推荐

release/* （发布分支）
  └── 预发布分支
  └── 命名：release/v1.0.0

hotfix/* （紧急修复分支）
  └── 生产环境bug修复
  └── 命名：hotfix/修复登录问题
```

**分支命名规范**：
```bash
# 功能分支
git checkout -b feature/tool-search
git checkout -b feature/ai-chat

# 修复分支
git checkout -b fix/login-error
git checkout -b fix/rating-bug

# 发布分支
git checkout -b release/v1.0.0

# 热修复分支
git checkout -b hotfix/critical-bug
```

### 2.2 Commit规范

**Commit Message格式**：
```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type类型**：
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档修改
- `style`: 代码格式（不影响代码运行）
- `refactor`: 重构（既不是新增功能，也不是修复bug）
- `perf`: 性能优化
- `test`: 增加测试
- `chore`: 构建过程或辅助工具的变动

**示例**：
```bash
# 新功能
git commit -m "feat(tool): 添加工具搜索功能"

# 修复bug
git commit -m "fix(user): 修复登录token过期问题"

# 文档
git commit -m "docs(readme): 更新部署文档"

# 性能优化
git commit -m "perf(api): 优化工具列表查询性能"

# 详细提交
git commit -m "feat(ai): 实现AI对话推荐功能

- 集成Ollama本地模型
- 实现意图识别算法
- 添加向量检索功能
- 优化推荐结果排序

Closes #123"
```

### 2.3 Pull Request规范

**PR标题**：
```
[Feature] 实现工具搜索功能
[Fix] 修复用户登录bug
[Refactor] 重构AI推荐服务
```

**PR描述模板**：
```markdown
## 变更类型
- [ ] 新功能
- [x] Bug修复
- [ ] 重构
- [ ] 文档更新

## 变更说明
简要描述本次变更的内容和原因。

## 测试情况
- [ ] 单元测试通过
- [ ] 集成测试通过
- [ ] 手动测试通过

## 相关Issue
Closes #123

## 截图（如果有UI变更）
![screenshot](url)

## 检查清单
- [ ] 代码符合规范
- [ ] 添加了必要的注释
- [ ] 更新了相关文档
- [ ] 没有引入新的警告
```

---

## 三、数据库规范

### 3.1 SQL编写规范

```sql
-- 1. 使用小写字母和下划线
-- ✅ 正确
SELECT id, name, created_at FROM tool WHERE status = 1;

-- ❌ 错误
SELECT ID, Name, CreatedAt FROM Tool WHERE Status = 1;

-- 2. 合理使用索引
-- ✅ 正确：使用索引字段
SELECT * FROM tool WHERE category_id = 1 AND status = 1;

-- ❌ 错误：不使用索引字段
SELECT * FROM tool WHERE YEAR(created_at) = 2024;  -- 函数破坏索引

-- 3. 避免SELECT *
-- ✅ 正确：只查询需要的字段
SELECT id, name, logo FROM tool WHERE id = 1;

-- ❌ 错误：查询所有字段
SELECT * FROM tool WHERE id = 1;

-- 4. 使用LIMIT
-- ✅ 正确：分页查询
SELECT id, name FROM tool ORDER BY created_at DESC LIMIT 20 OFFSET 0;

-- ❌ 错误：全表扫描
SELECT id, name FROM tool ORDER BY created_at DESC;

-- 5. JOIN优化
-- ✅ 正确：小表驱动大表
SELECT t.*, c.name AS category_name
FROM tool t
INNER JOIN category c ON t.category_id = c.id
WHERE t.status = 1;

-- 6. 批量操作
-- ✅ 正确：批量插入
INSERT INTO tool_tag (tool_id, tag_id) VALUES
  (1, 10),
  (1, 11),
  (1, 12);

-- ❌ 错误：逐条插入
INSERT INTO tool_tag (tool_id, tag_id) VALUES (1, 10);
INSERT INTO tool_tag (tool_id, tag_id) VALUES (1, 11);
INSERT INTO tool_tag (tool_id, tag_id) VALUES (1, 12);
```

### 3.2 MyBatis规范

```xml
<!-- ToolMapper.xml -->
<mapper namespace="com.toolrecommend.mapper.ToolMapper">

    <!-- ResultMap：复用结果映射 -->
    <resultMap id="BaseResultMap" type="com.toolrecommend.entity.Tool">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="tagline" property="tagline"/>
        <result column="created_at" property="createdAt"/>
    </resultMap>

    <!-- 使用${}的场景：动态表名、ORDER BY -->
    <select id="selectByCondition" resultMap="BaseResultMap">
        SELECT * FROM tool
        WHERE status = 1
        <if test="categoryId != null">
            AND category_id = #{categoryId}
        </if>
        <if test="keyword != null and keyword != ''">
            AND (name LIKE CONCAT('%', #{keyword}, '%')
                 OR tagline LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        ORDER BY ${orderBy} ${orderDirection}
        LIMIT #{offset}, #{limit}
    </select>

    <!-- 批量插入 -->
    <insert id="batchInsert">
        INSERT INTO tool_tag (tool_id, tag_id) VALUES
        <foreach collection="list" item="item" separator=",">
            (#{item.toolId}, #{item.tagId})
        </foreach>
    </insert>

</mapper>
```

---

## 四、测试规范

### 4.1 单元测试

```java
@SpringBootTest
class ToolServiceTest {

    @Autowired
    private ToolService toolService;

    @MockBean
    private ToolMapper toolMapper;

    @Test
    @DisplayName("根据ID获取工具 - 成功")
    void getToolById_Success() {
        // Given
        Long toolId = 1L;
        Tool mockTool = new Tool();
        mockTool.setId(toolId);
        mockTool.setName("Notion");

        when(toolMapper.selectById(toolId)).thenReturn(mockTool);

        // When
        Tool result = toolService.getToolById(toolId);

        // Then
        assertNotNull(result);
        assertEquals(toolId, result.getId());
        assertEquals("Notion", result.getName());

        verify(toolMapper, times(1)).selectById(toolId);
    }

    @Test
    @DisplayName("根据ID获取工具 - 工具不存在")
    void getToolById_NotFound() {
        // Given
        Long toolId = 999L;
        when(toolMapper.selectById(toolId)).thenReturn(null);

        // When & Then
        assertThrows(ToolNotFoundException.class, () -> {
            toolService.getToolById(toolId);
        });
    }
}
```

### 4.2 集成测试

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
class ToolControllerIntegrationTest {

    @Autowired
    private MockMvc mockMvc;

    @Autowired
    private ObjectMapper objectMapper;

    @Test
    @DisplayName("获取工具列表 - 成功")
    void getTools_Success() throws Exception {
        mockMvc.perform(get("/api/tools")
                .param("page", "1")
                .param("size", "20")
                .contentType(MediaType.APPLICATION_JSON))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.code").value(200))
            .andExpect(jsonPath("$.data.items").isArray())
            .andDo(print());
    }

    @Test
    @DisplayName("创建工具 - 参数校验失败")
    void createTool_ValidationError() throws Exception {
        ToolCreateDTO dto = new ToolCreateDTO();
        // 缺少必填字段

        mockMvc.perform(post("/api/tools")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(dto)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.code").value(400));
    }
}
```

---

## 五、接口文档规范

### 5.1 Swagger注解

```java
@RestController
@RequestMapping("/api/tools")
@Tag(name = "工具管理", description = "工具相关接口")
public class ToolController {

    @Operation(summary = "获取工具列表", description = "支持分页和筛选")
    @Parameters({
        @Parameter(name = "page", description = "页码", example = "1"),
        @Parameter(name = "size", description = "每页数量", example = "20"),
        @Parameter(name = "categoryId", description = "分类ID", required = false)
    })
    @ApiResponses({
        @ApiResponse(responseCode = "200", description = "成功"),
        @ApiResponse(responseCode = "400", description = "参数错误")
    })
    @GetMapping
    public Result<Page<ToolVO>> getTools(
        @RequestParam(defaultValue = "1") Integer page,
        @RequestParam(defaultValue = "20") Integer size,
        @RequestParam(required = false) Integer categoryId
    ) {
        // ...
    }

    @Operation(summary = "创建工具", description = "创建新工具（需要管理员权限）")
    @PostMapping
    @PreAuthorize("hasRole('ADMIN')")
    public Result<Long> createTool(
        @RequestBody @Valid ToolCreateDTO dto
    ) {
        // ...
    }
}
```

---

## 六、代码审查清单

### 6.1 提交前自查

```
功能实现：
□ 功能是否完整实现
□ 是否符合需求文档
□ 边界条件是否考虑

代码质量：
□ 命名是否规范
□ 注释是否清晰
□ 代码是否有重复
□ 是否符合设计模式

性能：
□ 是否有N+1查询
□ 是否有慢查询
□ 是否有内存泄漏
□ 是否有合理缓存

安全：
□ 是否有SQL注入风险
□ 是否有XSS风险
□ 是否有敏感信息泄露
□ 权限控制是否正确

测试：
□ 是否有单元测试
□ 测试覆盖率是否达标
□ 是否通过集成测试

文档：
□ 是否更新API文档
□ 是否更新README
□ 是否添加必要注释
```

---

## 七、项目目录结构

```
tool-recommend/
├── backend/                        # 后端项目
│   ├── gateway-service/           # 网关服务
│   ├── tool-service/              # 工具服务
│   │   ├── src/
│   │   │   ├── main/
│   │   │   │   ├── java/
│   │   │   │   │   └── com/toolrecommend/
│   │   │   │   │       ├── controller/    # 控制器
│   │   │   │   │       ├── service/       # 服务层
│   │   │   │   │       ├── repository/    # 数据访问
│   │   │   │   │       ├── entity/        # 实体类
│   │   │   │   │       ├── dto/           # 数据传输对象
│   │   │   │   │       ├── vo/            # 视图对象
│   │   │   │   │       ├── config/        # 配置类
│   │   │   │   │       ├── exception/     # 异常类
│   │   │   │   │       └── util/          # 工具类
│   │   │   │   └── resources/
│   │   │   │       ├── mapper/            # MyBatis XML
│   │   │   │       ├── application.yml
│   │   │   │       └── logback-spring.xml
│   │   │   └── test/                      # 测试代码
│   │   ├── Dockerfile
│   │   └── pom.xml
│   ├── user-service/              # 用户服务
│   ├── ai-service/                # AI服务
│   └── pom.xml                    # 父POM
├── frontend/                      # 前端项目
│   ├── uniapp/                    # UniApp多端
│   │   ├── pages/
│   │   ├── components/
│   │   ├── api/
│   │   ├── store/
│   │   └── utils/
│   └── admin/                     # 管理后台
├── deployment/                    # 部署文件
│   ├── k8s/                      # K8s配置
│   ├── docker-compose.yml
│   └── Jenkinsfile
├── docs/                          # 文档
│   ├── 产品需求文档.md
│   ├── 技术架构文档.md
│   └── API接口文档.md
├── scripts/                       # 脚本
│   ├── init-db.sql
│   └── deploy.sh
├── .gitignore
└── README.md
```

---

**文档版本**：v1.0
**最后更新**：2025-12-04
